<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BharatComfort Listings</title>
<style>
  body{margin:0;font-family:Arial,system-ui;background:#121212;color:#fff}
  header{padding:18px 20px;background:#000;font-weight:700;text-align:center}
  .controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:14px;background:#1a1a1a}
  select,input,button{padding:10px 12px;border-radius:8px;border:none;font-size:14px}
  select,input{background:#0f0f0f;color:#eee;border:1px solid #2a2a2a}
  button{background:#FFD700;color:#000;font-weight:700;cursor:pointer}
  button:hover{background:#e6c200}
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  .count{opacity:.8;margin:0 0 10px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px}
  .card{background:#1e1e1e;border-radius:12px;padding:14px;box-shadow:0 4px 10px rgba(0,0,0,.6)}
  .img{width:100%;height:170px;border-radius:10px;background:#0f0f0f;display:block;object-fit:cover}
  h3{margin:10px 0 4px;font-size:18px;color:#FFD700}
  p{margin:4px 0;font-size:14px}
  .btn{display:inline-block;margin-top:8px;padding:8px 12px;background:#FFD700;color:#000;border-radius:8px;text-decoration:none;font-weight:700}
  .btn:hover{background:#e6c200}
</style>
</head>
<body>
<header>BharatComfort Listings</header>

<div class="controls">
  <select id="citySel"></select>
  <select id="typeSel">
    <option value="hotels">Hotels</option>
    <option value="restaurants">Restaurants</option>
  </select>
  <input id="q" placeholder="Search name…" />
  <button id="applyBtn">Apply</button>
</div>

<div class="wrap">
  <p class="count" id="heading">Loading…</p>
  <div id="grid" class="grid"></div>
</div>

<script>
  let DATA = {};
  let city = 'Delhi', type = 'hotels';

  const byId = id => document.getElementById(id);

  async function init(){
    const res = await fetch('listings.json');
    DATA = await res.json();

    // populate city dropdown
    const citySel = byId('citySel');
    Object.keys(DATA).sort().forEach(c=>{
      const o=document.createElement('option'); o.value=o.textContent=c; citySel.appendChild(o);
    });

    // pick from URL if present
    const p = new URLSearchParams(location.search);
    city = p.get('city') || city;
    type = (p.get('type')==='restaurants') ? 'restaurants' : (p.get('type')==='hotels' ? 'hotels' : type);

    citySel.value = city;
    byId('typeSel').value = type;

    // events
    byId('applyBtn').onclick = () => {
      city = citySel.value;
      type = byId('typeSel').value;
      render();
      const url = new URL(location);
      url.searchParams.set('city', city);
      url.searchParams.set('type', type);
      history.replaceState(null,'',url);
    };
    byId('q').oninput = () => render();

    render();
  }

  function render(){
    const list = (DATA[city] && DATA[city][type]) ? DATA[city][type] : [];
    const q = byId('q').value.trim().toLowerCase();
    const filtered = q ? list.filter(x=>x.name.toLowerCase().includes(q)) : list;

    byId('heading').textContent = `${type==='hotels'?'Hotels':'Restaurants'} in ${city} • ${filtered.length} result(s)`;
    const grid = byId('grid'); grid.innerHTML='';

    if(!filtered.length){
      grid.innerHTML = `<p>No results found.</p>`;
      return;
    }

    filtered.forEach((item, idx)=>{
      const card = document.createElement('div');
      card.className = 'card';
      const imgSrc = item.image || 'assets/images/placeholder.jpg';
      card.innerHTML = `
        <img class="img" src="${imgSrc}" alt="${item.name}">
        <h3>${item.name}</h3>
        <p><strong>Address:</strong> ${item.address||'-'}</p>
        <p><strong>Price:</strong> ${item.price||'-'}</p>
        <a class="btn" href="detail.html?city=${encodeURIComponent(city)}&type=${encodeURIComponent(type)}&id=${idx}">Details</a>
      `;
      grid.appendChild(card);
    });
  }

  init();
</script>
</body>
</html>
